<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="/static/favicon.png">
  
  <!-- Material Web Components Setup -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL@20..48,100..700,0..1" rel="stylesheet">
  
  <script type="importmap">
    {
      "imports": {
        "@material/web/": "https://esm.run/@material/web/"
      }
    }
  </script>
  <script type="module">
    import '@material/web/all.js';
    import {styles as typescaleStyles} from '@material/web/typography/md-typescale-styles.js';
    document.adoptedStyleSheets.push(typescaleStyles.styleSheet);
  </script>
  
  <title>Kubernetes Config - {{.ClusterName}}</title>
  
  <style>
    /* Material Design 3 Color Scheme - Matching login.html */
    :root {
      /* Primary Colors */
      --md-sys-color-primary: #006A6A;
      --md-sys-color-on-primary: #FFFFFF;
      --md-sys-color-primary-container: #6FF7F6;
      --md-sys-color-on-primary-container: #002020;
      
      /* Secondary Colors */
      --md-sys-color-secondary: #4A6363;
      --md-sys-color-on-secondary: #FFFFFF;
      --md-sys-color-secondary-container: #CCE8E7;
      --md-sys-color-on-secondary-container: #051F1F;
      
      /* Surface Colors */
      --md-sys-color-surface: #F4FFFE;
      --md-sys-color-on-surface: #161D1D;
      --md-sys-color-surface-variant: #DAE5E4;
      --md-sys-color-on-surface-variant: #3F4948;
      --md-sys-color-surface-container: #E6F3F2;
      --md-sys-color-surface-container-high: #DBE8E7;
      --md-sys-color-surface-container-highest: #D0DDDC;
      
      /* Other tokens */
      --md-sys-color-outline: #6F7979;
      --md-sys-color-outline-variant: #BEC9C8;
      --md-sys-color-shadow: #000000;
      --md-sys-color-scrim: #000000;
    }

    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--md-sys-color-primary-container) 0%, var(--md-sys-color-secondary-container) 100%);
      min-height: 100vh;
      font-family: 'Roboto', sans-serif;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .header-title {
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .header-title md-icon {
      --md-icon-size: 28px;
    }
    
    .main-container {
      flex: 1;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    
    .config-card {
      position: relative;
      background: var(--md-sys-color-surface);
      border-radius: 24px;
      padding: 32px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.2);
      --md-elevation-level: 3;
    }
    
    .config-header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .config-title {
      margin: 16px 0 8px 0;
      color: var(--md-sys-color-on-surface);
    }
    
    .config-subtitle {
      margin: 0 0 24px 0;
      color: var(--md-sys-color-on-surface-variant);
    }
    
    .config-content {
      background: var(--md-sys-color-surface-container);
      border-radius: 16px;
      padding: 24px;
      position: relative;
      border: 1px solid var(--md-sys-color-outline-variant);
    }
    
    .config-actions {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      gap: 8px;
    }
    
    .config-text {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.6;
      color: var(--md-sys-color-on-surface-variant);
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .cluster-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .info-card {
      position: relative;
      background: linear-gradient(135deg, var(--md-sys-color-primary) 0%, var(--md-sys-color-secondary) 100%);
      border-radius: 16px;
      padding: 24px;
      color: var(--md-sys-color-on-primary);
      --md-elevation-level: 2;
    }
    
    .info-card h3 {
      margin: 0 0 16px 0;
      font-size: 18px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-card p {
      margin: 8px 0;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .info-card .value {
      font-weight: 500;
      opacity: 1;
      word-break: break-all;
    }
    
    .logout-form {
      --md-filled-button-container-color: #dc3545;
      --md-filled-button-hover-container-color: #c82333;
    }
    
    .copy-button {
      --md-outlined-button-container-color: transparent;
      --md-outlined-button-outline-color: var(--md-sys-color-primary);
      --md-outlined-button-label-text-color: var(--md-sys-color-primary);
      --md-outlined-button-hover-container-color: var(--md-sys-color-primary-container);
    }
    
    .download-button {
      --md-filled-tonal-button-container-color: var(--md-sys-color-primary);
      --md-filled-tonal-button-label-text-color: var(--md-sys-color-on-primary);
    }

    /* Instructions Section */
    .instructions-section {
      margin-bottom: 32px;
    }

    .instructions-card {
      position: relative;
      background: var(--md-sys-color-surface-container);
      border-radius: 20px;
      padding: 28px;
      border: 1px solid var(--md-sys-color-outline-variant);
      --md-elevation-level: 1;
    }

    .instructions-title {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0 0 24px 0;
      color: var(--md-sys-color-on-surface);
      font-size: 24px;
      font-weight: 500;
    }

    .instructions-title md-icon {
      --md-icon-size: 28px;
      color: var(--md-sys-color-primary);
    }

    .instruction-steps {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .step {
      display: flex;
      gap: 16px;
      align-items: flex-start;
    }

    .step-number {
      width: 32px;
      height: 32px;
      background: var(--md-sys-color-primary);
      color: var(--md-sys-color-on-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      font-size: 16px;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
    }

    .step-content h3 {
      margin: 0 0 8px 0;
      color: var(--md-sys-color-on-surface);
      font-size: 18px;
      font-weight: 500;
    }

    .step-content p {
      margin: 0 0 12px 0;
      color: var(--md-sys-color-on-surface-variant);
      line-height: 1.5;
    }

    .step-note {
      font-style: italic;
      opacity: 0.8;
      font-size: 14px !important;
    }

    .code-block {
      position: relative;
      background: var(--md-sys-color-surface-variant);
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      border: 1px solid var(--md-sys-color-outline-variant);
    }

    .code-actions {
      position: absolute;
      top: 8px;
      right: 8px;
    }

    .code-text {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
      line-height: 1.4;
      color: var(--md-sys-color-on-surface-variant);
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
      padding-right: 40px;
    }

    .step-content code {
      background: var(--md-sys-color-surface-variant);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
      color: var(--md-sys-color-primary);
    }
    
    @media (max-width: 768px) {
      .header {
        padding: 12px 16px;
      }
      
      .main-container {
        padding: 16px;
      }
      
      .config-card {
        padding: 24px 16px;
        border-radius: 16px;
      }
      
      .cluster-info {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .config-actions {
        position: static;
        justify-content: center;
        margin-bottom: 16px;
      }

      .step {
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }

      .step-number {
        align-self: center;
      }

      .instructions-card {
        padding: 20px 16px;
      }

      .code-text {
        font-size: 12px;
        padding-right: 40px;
      }
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --md-sys-color-primary: #4DD0CE;
        --md-sys-color-on-primary: #003737;
        --md-sys-color-primary-container: #004F4F;
        --md-sys-color-on-primary-container: #6FF7F6;
        
        --md-sys-color-secondary: #B0CCCC;
        --md-sys-color-on-secondary: #1B3535;
        --md-sys-color-secondary-container: #324B4B;
        --md-sys-color-on-secondary-container: #CCE8E7;
        
        --md-sys-color-surface: #0F1415;
        --md-sys-color-on-surface: #E0E3E2;
        --md-sys-color-surface-variant: #3F4948;
        --md-sys-color-on-surface-variant: #BEC9C8;
        --md-sys-color-surface-container: #1A2121;
        --md-sys-color-surface-container-high: #252B2B;
        --md-sys-color-surface-container-highest: #303636;
        
        --md-sys-color-outline: #889392;
        --md-sys-color-outline-variant: #3F4948;
      }
      
      body {
        background: linear-gradient(135deg, #0F1415 0%, #1A2121 100%);
      }
    }

    /* Reduced motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
      .fade-in {
        animation: none;
      }
      
      .config-card {
        transition: none;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-title">
      <md-icon>settings</md-icon>
      <h1 class="md-typescale-headline-small">Kubernetes Configuration</h1>
    </div>
    <form action="/apis/auth/logout" method="POST" class="logout-form">
      <md-filled-button type="submit" has-icon>
        <md-icon slot="icon">logout</md-icon>
        Logout
      </md-filled-button>
    </form>
  </header>

  <!-- Main Content -->
  <main class="main-container">
    <div class="config-card fade-in">
      <md-elevation></md-elevation>
      
      <!-- Header Section -->
      <div class="config-header">
        <md-icon style="--md-icon-size: 48px; color: var(--md-sys-color-primary);">account_tree</md-icon>
        <h1 class="md-typescale-display-small config-title">Welcome to {{.ClusterName}}</h1>
        <p class="md-typescale-body-large config-subtitle">Your Kubernetes configuration is ready to use</p>
      </div>

      <!-- Cluster Information Cards -->
      <div class="cluster-info">
          <div class="info-card fade-in">
          <md-elevation></md-elevation>
          <h3>
            <md-icon>dns</md-icon>
            Cluster Details
          </h3>
          <p><strong>Name:</strong> <span class="value">{{.ClusterName}}</span></p>
          <p><strong>Server:</strong> <span class="value">{{.APIServerURL}}</span></p>
          <p><strong>Proxy:</strong> <span class="value">{{if .Production}}none{{else}}socks5://localhost:10231{{end}}</span></p>
        </div>
        
        <div class="info-card fade-in" style="animation-delay: 0.1s;">
          <md-elevation></md-elevation>
          <h3>
            <md-icon>person</md-icon>
            Authentication
          </h3>
          <p><strong>Username:</strong> <span class="value">{{.Username}}</span></p>
          <p><strong>Provider:</strong> <span class="value">OIDC</span></p>
          <p><strong>Issuer:</strong> <span class="value">{{.IDPIssuerURL}}</span></p>
        </div>
      </div>

      <!-- Instructions Section -->
      <div class="instructions-section fade-in" style="animation-delay: 0.15s;">
        <div class="instructions-card">
          <md-elevation></md-elevation>
          <h2 class="instructions-title">
            <md-icon>help_outline</md-icon>
            Setup Instructions
          </h2>
          
          <div class="instruction-steps">
            {{ if not .Production }}
            <div class="step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>Establish SSH Proxy Connection</h3>
                <p>First, open a proxy connection on port 10231 using the following command:</p>
                <div class="code-block">
                  <div class="code-actions">
                    <md-icon-button onclick="copySSHCommand()">
                      <md-icon>content_copy</md-icon>
                    </md-icon-button>
                  </div>
                  <pre class="code-text" id="ssh-command">ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o ProxyCommand="ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -p 24341 -W %h:%p jump@tokyo1.gateway.ishiori.net" -fND 10231 chloe@10.1.0.21</pre>
                </div>
                <p class="step-note">Keep this terminal session running in the background.</p>
              </div>
            </div>

            <div class="step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>Create Kubeconfig File</h3>
                <p>Save the Kubernetes configuration below to a file (e.g., <code>{{.ClusterName}}-kubeconfig.yaml</code>):</p>
                <p class="step-note">You can use the Copy or Download buttons in the configuration section.</p>
              </div>
            </div>

            <div class="step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h3>Use with kubectl</h3>
                <p>Use the configuration with kubectl. We recommend using the <code>--kubeconfig</code> flag:</p>
                <div class="code-block">
                  <div class="code-actions">
                    <md-icon-button onclick="copyKubectlCommand()">
                      <md-icon>content_copy</md-icon>
                    </md-icon-button>
                  </div>
                  <pre class="code-text" id="kubectl-command">kubectl --kubeconfig={{.ClusterName}}-kubeconfig.yaml auth whoami</pre>
                </div>
                <p class="step-note">Replace the filename with your actual kubeconfig file path.</p>
              </div>
            </div>
            {{ else }}
            <div class="step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3>Create Kubeconfig File</h3>
                <p>Save the Kubernetes configuration below to a file (e.g., <code>{{.ClusterName}}-kubeconfig.yaml</code>):</p>
                <p class="step-note">You can use the Copy or Download buttons in the configuration section.</p>
              </div>
            </div>

            <div class="step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3>Use with kubectl</h3>
                <p>Use the configuration with kubectl. We recommend using the <code>--kubeconfig</code> flag:</p>
                <div class="code-block">
                  <div class="code-actions">
                    <md-icon-button onclick="copyKubectlCommand()">
                      <md-icon>content_copy</md-icon>
                    </md-icon-button>
                  </div>
                  <pre class="code-text" id="kubectl-command">kubectl --kubeconfig={{.ClusterName}}-kubeconfig.yaml auth whoami</pre>
                </div>
                <p class="step-note">Replace the filename with your actual kubeconfig file path.</p>
              </div>
            </div>
            {{ end }}
          </div>
        </div>
      </div>

      <!-- Configuration Section -->
      <div class="config-content fade-in" style="animation-delay: 0.2s;">
          <div class="config-actions">
          <md-outlined-button class="copy-button" onclick="copyConfig()">
            <md-icon slot="icon">content_copy</md-icon>
            Copy
          </md-outlined-button>
          <md-filled-tonal-button class="download-button" onclick="downloadConfig()">
            <md-icon slot="icon">download</md-icon>
            Download
          </md-filled-tonal-button>
        </div>
        
        <pre class="config-text" id="kubeconfig">apiVersion: v1
kind: Config
clusters:
- cluster:
    server: {{.APIServerURL}}{{if not .Production}}
    proxy-url: socks5://localhost:10231{{end}}
  name: {{.ClusterName}}-cluster
users:
- name: {{.Username}}-{{.ClusterName}}-cluster
  user:
    auth-provider:
      name: oidc
      config:
        idp-issuer-url: {{.IDPIssuerURL}}
        client-id: {{.ClientID}}
        client-secret: {{.ClientSecret}}
        refresh-token: {{.RefreshToken}}
        id-token: {{.IDToken}}
contexts:
- context:
    cluster: {{.ClusterName}}-cluster
    user: {{.Username}}-{{.ClusterName}}-cluster
  name: {{.ClusterName}}-context
current-context: {{.ClusterName}}-context</pre>
      </div>
    </div>
  </main>

  <script>
    function copyConfig() {
      const configText = document.getElementById('kubeconfig').textContent;
      navigator.clipboard.writeText(configText).then(() => {
        console.log('Configuration copied to clipboard');
        // You could add a snackbar here to show success
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
    
    function copySSHCommand() {
      const sshCommand = document.getElementById('ssh-command').textContent;
      navigator.clipboard.writeText(sshCommand).then(() => {
        console.log('SSH command copied to clipboard');
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
    
    function copyKubectlCommand() {
      const kubectlCommand = document.getElementById('kubectl-command').textContent;
      navigator.clipboard.writeText(kubectlCommand).then(() => {
        console.log('Kubectl command copied to clipboard');
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }
    
    function downloadConfig() {
      const configText = document.getElementById('kubeconfig').textContent;
      const blob = new Blob([configText], { type: 'text/yaml' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = '{{.ClusterName}}-kubeconfig.yaml';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>